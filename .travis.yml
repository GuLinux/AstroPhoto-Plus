if: '(branch = master OR type = pull_request OR commit_message =~ /.*#trigger_ci.*/) AND (NOT commit_message =~ /.*#skip_ci.*/) AND ( tag IS blank )'
env:
    - CI=false 
matrix:
    include:
        - language: javascript
          name: Astrophoto Plus
          dist: bionic
          os: linux
          before_install:
              - sudo apt-get update
              - sudo apt-get install -y cmake
              - export VERSION_NUMBER_CI=$(( $TRAVIS_BUILD_NUMBER + 801 ))
              - echo "Version number: ${VERSION_NUMBER_CI}"
          install:
          before_script:
              - mkdir ${TRAVIS_BUILD_DIR}/build
              - cd ${TRAVIS_BUILD_DIR}/build
          script:
              - cmake ${TRAVIS_BUILD_DIR} -DCMAKE_INSTALL_PREFIX=/usr -DCONFDIR=/etc -DVERSION_SUFFIX=-b${VERSION_NUMBER_CI}
              - make -j$(nproc) package
              - rm -rf packages/_CPack_Packages
              - ls -alh ${TRAVIS_BUILD_DIR}/build/packages
#          before_deploy:
#              - cd "${TRAVIS_BUILD_DIR}/build"
#              - echo ${PROJECT_VERSION}
#              - export VERSION=${PROJECT_VERSION}
#              - ${TRAVIS_BUILD_DIR}/build/linuxdeployqt*.AppImage appdir/usr/share/applications/*.desktop -bundle-non-qt-libs
#              - cp -av /usr/lib/x86_64-linux-gnu/nss/* appdir/usr/lib/
#              - ${TRAVIS_BUILD_DIR}/build/appimagetool*.AppImage appdir
#              - sudo apt-get install python3 python3-venv
#              - wget --quiet "https://raw.githubusercontent.com/GuLinux/GuLinux-Commons/a68a8df028a02ce2730720b9aec8c77f5ada7496/python/travis_release.py"
#              - ls -alh ${TRAVIS_BUILD_DIR}/build
#              - md5sum travis_release.py
#              - python3 -m venv ${TRAVIS_BUILD_DIR}/build/venv
#              - source ${TRAVIS_BUILD_DIR}/build/venv/bin/activate
#              - pip3 install PyGithub
#          deploy:
#            skip_cleanup: true
#            provider: script
#            script: python3 "${TRAVIS_BUILD_DIR}/build/travis_release.py" "${TRAVIS_BUILD_DIR}/build"/AstroPhoto*AppImage*
#            on:
#              branch:
#                - master
#              tags: false
#
