#!/bin/bash

install-indi-ppa() {
    echo "Adding INDI PPA."
    sudo add-apt-repository ppa:mutlaqja/ppa
    echo "Updating packages database"
    sudo apt-get update
    echo "Installing INDI full"
    sudo apt-get install -y indi-full
}

install-indi-raspbian() {
    mkdir /tmp/indi-setup && cd /tmp/indi-setup
    echo "Downloading INDI Raspbian archive"
    wget http://www.indilib.org/download/raspberry-pi/send/6-raspberry-pi/9-indi-library-for-raspberry-pi.html -O indi.tar.gz
    tar xf indi.tar.gz && rm indi.tar.gz
    cd libindi_*
    echo "Updating packages database"
    sudo apt update
    echo "Installing INDI"
    sudo apt install -y ./*.deb

    cd /
    rm -rf /tmp/indi-setup
}

distributor_id="$( lsb_release --id -s )"

case "$distributor_id" in
    Ubuntu)
        install-indi-ppa
        ;;
    Raspbian)
        install-indi-raspbian
        ;;
    *)
        cat >&2 <<EOF
Unsupported distribution, please install INDI manually.
Please go to https://www.indilib.org/ and look for downloads for your platform.
EOF
        ;;
esac
